<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>Messages</title>
</head>

<body>
    <div class="header">
        <h2>The Dojo Exchange</h2>
        <nav>
            <a href="/dashboard">Exchange</a>|
            <a href="/account">My Account</a>|
            <a href="/cart">My Cart</a>|
            <a href="/logout">Log Out</a>
        </nav>
    </div>
    <div class="container">
        <h2>{{ request.session.user_name }}'s Messages</h2>
        <div id="posted_messages">
            <h3>Your Messages:</h3>
            {% if messages %}
            {% for message in messages %}
            <p><b>About: {{item.message_item.item_name}}</b></p>
            <p>{{ message.message }}</p>
            <h6><b>-{{ message.sender.first_name }} {{ message.sender.last_name }}</b> - {{ message.created_at }}</h6>
            {% if message.sender.id == request.session.user_id %}
            <a href="/delete_message/{{ message.id }}">Delete</a>
            {% endif %}
            {% if message.receiver.id == request.session.user_id %}
            <div class="container">
                <!-- Trigger the modal with a button -->
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
                    data-target="#myModal">Reply</button>

                <!-- Modal -->
                <div class="modal fade" id="myModal" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form action="/message/{{ item.id }}" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="message">Reply to {{message.sender.first_name}}:</label><textarea class="form-control" rows="5" cols="30"
                                            name="message"></textarea>
                                    </div>

                                </form>
                            </div>
                            <div class="modal-footer">
                                <input type="hidden" value="{{item.seller.id}}" name="seller_id">
                                <button class="btn btn-default" type="submit" data-dismiss="modal">Reply</button>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
            {% endif %}
            {% endfor %}
            {% endif %}
        </div>

    </div>

</body>

</html>